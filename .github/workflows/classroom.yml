name: GitHub Classroom Workflow

on: [push]

permissions:
  checks: write
  actions: read
  contents: read

jobs:
  build:
    name: Virtual Rig Audit
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      # Step 1: Python Register Check
      - name: Verify I2C Register Contract
        run: python3 firmware/tests/verify_registers.py

      # Step 2: I2C Test
      - name: I2C Interface Audit
        run: |
          gcc -std=c11 firmware/src/i2c_slave.c firmware/tests/test_i2c_logic.c \
          -I firmware/include -o firmware/tests/i2c_audit -lm && ./firmware/tests/i2c_audit

      # Step 3: Physics/DSP Unit Test
      - name: Verify DOA Logic (C Compilation)
        run: |
          gcc -std=c11 firmware/src/doa_engine.c firmware/tests/test_doa.c \
          -I firmware/include -o firmware/tests/test_doa -lm && ./firmware/tests/test_doa
